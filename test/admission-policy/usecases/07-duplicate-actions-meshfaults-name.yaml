# ------------------------------------------------------------------------------
# EXPECT: DENY
# EXPECT_MSG_CONTAINS: The faultinjections "fi-inbound-latency" is invalid: : ValidatingAdmissionPolicy 'faultinjection.chaos.sghaida.io' with binding 'faultinjection.chaos.sghaida.io' denied request: actions.meshFaults[].name must be unique w
# NOTE: Scenario: Duplicate actions.meshFaults[].name
# ------------------------------------------------------------------------------
apiVersion: chaos.sghaida.io/v1alpha1
kind: FaultInjection
metadata:
  name: fi-inbound-latency
  namespace: demo
spec:
  blastRadius:
    durationSeconds: 60
    maxTrafficPercent: 10
    scope: namespace
  actions:
    meshFaults:
      -
        name: inbound-latency
        direction: INBOUND
        type: HTTP_LATENCY
        percent: 10
        http:
          virtualServiceRef:
            name: httpbin
          routes:
            -
              match:
                uriPrefix: /
          delay:
            fixedDelaySeconds: 2
      -
        name: inbound-latency
        direction: INBOUND
        type: HTTP_ABORT
        percent: 10
        http:
          virtualServiceRef:
            name: httpbin
          routes:
            -
              match:
                uriPrefix: /
          abort:
            httpStatus: 503
